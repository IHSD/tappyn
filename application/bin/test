#!/bin/bash

function help () {
    echo "test - a simple script for managing our test envrionment"
    echo ""
    echo "    test up   - Create test database"
    echo "    test down - Delete test database"
    echo "    test run  - Run through tests and spin up server at *:8000 for review"
}


if [ $1 ]
then
    case "$1" in
        up)
            echo "CREATE DATABASE test_tappyn_db" | mysql -u root -pdavol350
            php vendor/bin/phinx migrate -e testing
            php vendor/bin/phinx seed:run -e testing -s AuthSeeder
            php vendor/bin/phinx seed:run -e testing -s GroupSeeder
            php vendor/bin/phinx seed:run -e testing -s UserSeeder
            php vendor/bin/phinx seed:run -e testing -s CompanySeeder
            for i in {1..3}; do php vendor/bin/phinx seed:run -e testing -s ContestSeeder; done
            for i in {1..5}; do php vendor/bin/phinx seed:run -e testing -s SubmissionSeeder; done
            for i in {1..5}; do php vendor/bin/phinx seed:run -e testing -s VoteSeeder; done
            for i in {1..5}; do php vendor/bin/phinx seed:run -e testing -s NotificationSeeder; done

        ;;
        down)
            echo "DROP DATABASE test_tappyn_db" | mysql -u root -pdavol350
        ;;
        run)
            echo "Running tests"
            cd tests
            phpunit
            cd build/coverage && php -S localhost:8000
        ;;
        *)
            help
        ;;
    esac
else
    help
fi
